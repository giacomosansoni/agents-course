# 通过思考-行动-观察循环理解AI代理

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/whiteboard-check-3.jpg" alt="Unit 1 planning"/>

在前几节中，我们学习了：

- **如何在系统提示中为代理提供工具**。
- **AI代理是如何成为能够'推理'、规划并与环境交互的系统**。

在本节中，**我们将探索完整的AI代理工作流程**，这是我们定义的思考-行动-观察循环。

然后，我们将深入探讨这些步骤的每一个环节。

## 核心组件

代理在一个持续的循环中工作：**思考(Thought) → 行动(Act) → 观察(Observe)**。

让我们一起分解这些行动：

1. **思考**：代理的LLM部分决定下一步应该做什么。
2. **行动**：代理通过调用工具及其相关参数来采取行动。
3. **观察**：模型对工具的响应进行反思。

## 思考-行动-观察循环

这三个组件在一个持续的循环中协同工作。用编程的类比来说，代理使用一个**while循环**：循环持续进行，直到代理的目标被达成。

视觉上，它看起来是这样的：

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/AgentCycle.gif" alt="思考、行动、观察循环"/>

在许多代理框架中，**规则和指南直接嵌入到系统提示中**，确保每个循环都遵循定义的逻辑。

在简化版本中，我们的系统提示可能如下所示：

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/system_prompt_cycle.png" alt="思考、行动、观察循环"/>

我们在这里看到系统消息中定义了：

- *代理的行为*。
- *我们的代理可以访问的工具*，正如我们在上一节中描述的。
- *思考-行动-观察循环*，我们将其植入LLM指令中。

让我们看一个小例子来理解这个过程，然后再深入了解过程的每个步骤。

## Alfred，天气代理

我们创建了Alfred，天气代理。

用户问Alfred："今天纽约的天气如何？"

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/alfred-agent.jpg" alt="Alfred代理"/>

Alfred的工作是使用天气API工具来回答这个查询。

以下是循环的展开过程：

### 思考

**内部推理：**

在收到查询后，Alfred的内部对话可能是：

*"用户需要纽约的当前天气信息。我可以访问一个获取天气数据的工具。首先，我需要调用天气API来获取最新详情。"*

这一步显示了代理将问题分解为步骤：首先，收集必要的数据。

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/alfred-agent-1.jpg" alt="Alfred代理"/>

### 行动

**工具使用：**

基于其推理和Alfred知道有一个`get_weather`工具的事实，Alfred准备了一个调用天气API工具的JSON格式命令。例如，它的第一个行动可能是：

思考：我需要检查纽约的当前天气。

```
{
  "action": "get_weather",
  "action_input": {
    "location": "New York"
  }
}
```

在这里，行动明确指定了要调用哪个工具（例如，get_weather）以及要传递什么参数（"location": "New York"）。

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/alfred-agent-2.jpg" alt="Alfred代理"/>

### 观察

**来自环境的反馈：**

工具调用后，Alfred收到一个观察结果。这可能是来自API的原始天气数据，如：

*"纽约当前天气：局部多云，15°C，湿度60%。"*

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/alfred-agent-3.jpg" alt="Alfred代理"/>

这个观察结果然后被添加到提示中作为额外的上下文。它作为现实世界的反馈，确认行动是否成功并提供所需的详细信息。

### 更新的思考

**反思：**

有了观察结果，Alfred更新其内部推理：

*"现在我有了纽约的天气数据，我可以为用户编制答案了。"*

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/alfred-agent-4.jpg" alt="Alfred代理"/>

### 最终行动

然后Alfred生成一个按照我们告诉它的格式的最终响应：

思考：我现在有天气数据了。纽约当前天气是局部多云，温度15°C，湿度60%。

最终答案：纽约当前天气是局部多云，温度15°C，湿度60%。

这个最终行动将答案发送回用户，完成循环。

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/alfred-agent-5.jpg" alt="Alfred代理"/>

我们在这个例子中看到：

- **代理在循环中迭代，直到目标达成：**
    
**Alfred的过程是循环的**。它从思考开始，然后通过调用工具采取行动，最后观察结果。如果观察表明有错误或数据不完整，Alfred可以重新进入循环来纠正其方法。
    
- **工具集成：**

调用工具（如天气API）的能力使Alfred能够**超越静态知识并检索实时数据**，这是许多AI代理的重要方面。

- **动态适应：**

每个循环允许代理将新信息（观察）整合到其推理（思考）中，确保最终答案是明智和准确的。
    
这个例子展示了*ReAct循环*背后的核心概念（这是我们将在下一节中展开的概念）：**思考、行动和观察的相互作用使AI代理能够迭代地解决复杂任务**。

通过理解和应用这些原则，你可以设计出不仅能对任务进行推理，而且**能有效利用外部工具来完成任务的代理**，同时基于环境反馈不断完善其输出。

---

让我们现在深入了解过程中的各个步骤：思考、行动、观察。