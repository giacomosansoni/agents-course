# Actions: 使AI代理能够与环境交互

<Tip>
 在本节中，我们将探讨AI代理与环境交互的具体步骤。

 我们将介绍动作的表示方式（使用JSON或代码）、停止和解析方法的重要性，以及不同类型的代理。
</Tip>

Actions（动作）是**AI代理与环境交互的具体步骤**。

无论是浏览网络获取信息还是控制物理设备，每个动作都是代理执行的一个有意识的操作。

例如，协助客户服务的代理可能会检索客户数据、提供支持文章或将问题转交给人工代表。

## 代理动作的类型

有多种类型的代理以不同方式执行动作：

| 代理类型              | 描述                                                                                          |
|----------------------|------------------------------------------------------------------------------------------------|
| JSON代理             | 要执行的动作以JSON格式指定。                                                                    |
| 代码代理             | 代理编写由外部解释的代码块。                                                                    |
| 函数调用代理         | 这是JSON代理的一个子类，经过微调以为每个动作生成新消息。                                        |

动作本身可以服务于多种目的：

| 动作类型             | 描述                                                                                  |
|---------------------|----------------------------------------------------------------------------------------|
| 信息收集            | 执行网络搜索、查询数据库或检索文档。                                                    |
| 工具使用            | 进行API调用、运行计算和执行代码。                                                       |
| 环境交互            | 操作数字界面或控制物理设备。                                                           |
| 通信                | 通过聊天与用户互动或与其他代理协作。                                                   |

代理的一个关键部分是**在动作完成时能够停止生成新的标记**，这对所有格式的代理都适用：JSON、代码或函数调用。这可以防止意外输出并确保代理的响应清晰准确。

LLM只处理文本，并使用它来描述它想要采取的动作和提供给工具的参数。

## 停止和解析方法

实现动作的一个关键方法是**停止和解析方法**。此方法确保代理的输出结构化且可预测：

1. **以结构化格式生成**：

代理以清晰、预定义的格式（JSON或代码）输出其预期动作。

2. **停止进一步生成**：

一旦动作完成，**代理停止生成额外标记**。这可以防止额外或错误的输出。

3. **解析输出**：

外部解析器读取格式化的动作，确定要调用哪个工具，并提取所需参数。

例如，需要检查天气的代理可能输出：

```json
Thought: 我需要检查纽约的当前天气。
Action :
{
  "action": "get_weather",
  "action_input": {"location": "New York"}
}
```
然后框架可以轻松解析要调用的函数名称和要应用的参数。

这种清晰的、机器可读的格式最大限度地减少了错误，并使外部工具能够准确处理代理的命令。

注意：函数调用代理通过结构化每个动作以便调用指定函数并使用正确的参数来实现类似的操作。
我们将在未来的单元中深入探讨这些类型的代理。

## 代码代理

另一种方法是使用*代码代理*。
其理念是：**代替输出简单的JSON对象**，代码代理生成一个**可执行的代码块——通常使用Python等高级语言**。

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/code-vs-json-actions.png" alt="代码代理" />

这种方法提供了几个优势：

- **表达能力：** 代码可以自然地表示复杂逻辑，包括循环、条件和嵌套函数，提供比JSON更大的灵活性。
- **模块化和可重用性：** 生成的代码可以包含在不同动作或任务中可重用的函数和模块。
- **增强的可调试性：** 使用明确定义的编程语法，代码错误通常更容易检测和纠正。
- **直接集成：** 代码代理可以直接与外部库和API集成，实现更复杂的操作，如数据处理或实时决策。

例如，负责获取天气的代码代理可能生成以下Python代码段：

```python
# 代码代理示例：检索天气信息
def get_weather(city):
    import requests
    api_url = f"https://api.weather.com/v1/location/{city}?apiKey=YOUR_API_KEY"
    response = requests.get(api_url)
    if response.status_code == 200:
        data = response.json()
        return data.get("weather", "无可用天气信息")
    else:
        return "错误：无法获取天气数据。"

# 执行函数并准备最终答案
result = get_weather("New York")
final_answer = f"纽约当前的天气是：{result}"
print(final_answer)
```

在这个例子中，代码代理：

- **通过API调用**检索天气数据，
- 处理响应，
- 并使用print()函数输出最终答案。

这种方法**也遵循停止和解析方法**，通过清晰地界定代码块并表明执行何时完成（这里是通过打印final_answer）。

---

我们了解到Actions通过执行清晰、结构化的任务（无论是通过JSON、代码还是函数调用）来连接代理的内部推理和其现实世界的交互。

这种深思熟虑的执行确保每个动作都是精确的，并准备好通过停止和解析方法进行外部处理。在下一节中，我们将探索Observations，看看代理如何捕获和整合来自环境的反馈。

在此之后，我们将**最终准备好构建我们的第一个代理！**