# Building and Integrating Tools for Your Agent

In this section, we'll be giving Alfred access to the web to help him find the latest news and information about the world. 
Additionally. we will give Alfred acess to weather details and models downloads statistics.

## Give Your Agent Access to the Web

Remember that we want Alfred to establish his presence as a true renaissance host, with a deep knowledge of the world.

To do so, we need to make sure that Alfred has access to the latest news and information about the world.

Let's start by creating a web search tool for Alfred!

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import DuckDuckGoSearchTool

# Initialize the DuckDuckGo search tool
search_tool = DuckDuckGoSearchTool()

# Example usage
results = search_tool("Who's the current President of France?")
print(results)
```

Expected output:

```python
The current President of France in Emmanuel Macron.
```


</hfoption>
<hfoption id="llama-index">

```python
from llama_index.tools.duckduckgo import DuckDuckGoSearchToolSpec
from llama_index.core.tools import FunctionTool

# Initialize the DuckDuckGo search tool
tool_spec = DuckDuckGoSearchToolSpec()

search_tool = FunctionTool.from_defaults(tool_spec.duckduckgo_full_search)
# Example usage
response = search_tool("Who's the current President of France?")
print(response)
```

Expected output:

```python
[{'title': 'President of France - Wikipedia', 'href': 'https://en.wikipedia.org/wiki/President_of_France', 'body': 'The president of France, officially the president of the French Republic (French: Président de la République française), is the executive head of state of France, and the commander-in-chief of the French Armed Forces.As the presidency is the supreme magistracy of the country, the position is the highest office in France. The powers, functions and duties of prior presidential offices, in ...'}, {'title': 'Emmanuel Macron - Wikipedia', 'href': 'https://en.wikipedia.org/wiki/Emmanuel_Macron', 'body': 'Emmanuel Jean-Michel Frédéric Macron (French: [emanɥɛl makʁɔ̃] ⓘ; born 21 December 1977) is a French politician who has served as President of France since 2017. He was Minister of Economics, Industry and Digital Affairs under President François Hollande between 2014-16. He has been a member of Renaissance since he founded it in 2016.. Born in Amiens, Macron studied philosophy at ...'}, {'title': 'Emmanuel Macron - Wife, Education & Family - Biography', 'href': 'https://www.biography.com/political-figures/emmanuel-macron', 'body': "Former economy minister Emmanuel Macron was elected president of France in 2017, making him the youngest president in the country's history. Search Women's History Month"}, {'title': 'Presidency of Emmanuel Macron - Wikipedia', 'href': 'https://en.wikipedia.org/wiki/Presidency_of_Emmanuel_Macron', 'body': 'Emmanuel Macron is currently serving as the 25th president of France.He took office upon winning the 2017 French presidential election.Macron was the founding member of Renaissance (originally En Marche ! and later La République En Marche !He defeated National Rally nominee Marine Le Pen.He again defeated Le Pen in the 2022 French presidential election.'}, {'title': 'Emmanuel Macron | Biography, Political Party, Age, Presidency, & Facts ...', 'href': 'https://www.britannica.com/biography/Emmanuel-Macron', 'body': "Emmanuel Macron (born December 21, 1977, Amiens, France) is a French banker and politician who was elected president of France in 2017. Macron was the first person in the history of the Fifth Republic to win the presidency without the backing of either the Socialists or the Gaullists, and he was France's youngest head of state since Napoleon I.He was reelected in 2022, becoming the first ..."}, {'title': 'Welcome to the website of the French Presidency - Élysée', 'href': 'https://www.elysee.fr/en/', 'body': "Welcome to the official website of the President of France The President's latest news All news 21 September 2023 State Visit of His Majesty King Charles III and Queen Camilla. 20 March 2025 European Council - 20 & 21 March 2025. 17 March 2025 Working lunch with the ..."}, {'title': 'Emmanuel Macron - Élysée', 'href': 'https://www.elysee.fr/en/emmanuel-macron', 'body': 'Emmanuel Macron is the eighth President of the Fifth Republic of France. He launched the movement « En Marche ! », founded on 6 April 2016, and was its leader until his victory in the presidential election on 7 May 2017. On 24 April 2022, Emmanuel Macron was re-elected President of the Republic.'}, {'title': 'Who is the current president of France? - ump-lycees.fr', 'href': 'https://www.ump-lycees.fr/en/who-is-the-current-president-of-france', 'body': 'Emmanuel Macron, born on December 21, 1977, is the current president of the French Republic.In office since May 14, 2017, he was re-elected on April 24, 2022 with 58.55% of the votes against his competitor Marine Le Pen. With a background in higher public service and investment banking, Macron approaches his mandate with a desire for change and innovation in various fields, including economics ...'}, {'title': 'Who is the President of France? - WorldAtlas', 'href': 'https://www.worldatlas.com/articles/who-is-the-president-of-france.html', 'body': "Emmanuel Macron is the current French President and also Andorra's ex-official Co-Prince. Before joining politics, he worked in various senior positions as a civil servant and he served in the Inspectorate General of Finances as an Inspector of Finances. In 2012, President Francois Hollande selected Macron as the Deputy Secretary-General in ..."}, {'title': 'President of the French Republic - Simple English Wikipedia, the free ...', 'href': 'https://simple.wikipedia.org/wiki/President_of_the_French_Republic', 'body': 'The President of the French Republic is the head of state of France. The current President is Emmanuel Macron since 14 May 2017 defeating Marine Le Pen in the second round of the presidential election on 7 May 2017. List of French presidents (Fifth Republic) N° Portrait Name ...'}]
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain_community.tools import DuckDuckGoSearchRun

search_tool = DuckDuckGoSearchRun()
results = search_tool.invoke("Who's the current President of France?")
print(results)
```

Expected output:

```python
The current President of France in Emmanuel Macron.
```

</hfoption>
</hfoptions>

## Creating a Custom Tool for Weather Information to Schedule the Fireworks

Remember that we need to make sure the fireworks are not cancelled due to bad weather?

Let's create a custom tool that can be used to call an external weather API and get the weather information for a given location.

<Tip>
For the sake of simplicity, we're using a dummy weather API for this example. If you want to use a real weather API, you could implement a weather tool that uses the OpenWeatherMap API, like in [Unit 1](../unit1/tutorial.mdx).
</Tip>

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import Tool
import random

class WeatherInfoTool(Tool):
    name = "weather_info"
    description = "Fetches dummy weather information for a given location."
    inputs = {
        "location": {
            "type": "string",
            "description": "The location to get weather information for."
        }
    }
    output_type = "string"

    def forward(self, location: str):
        # Dummy weather data
        weather_conditions = [
            {"condition": "Rainy", "temp_c": 15},
            {"condition": "Clear", "temp_c": 25},
            {"condition": "Windy", "temp_c": 20}
        ]
        # Randomly select a weather condition
        data = random.choice(weather_conditions)
        return f"Weather in {location}: {data['condition']}, {data['temp_c']}°C"

# Initialize the tool
weather_info_tool = WeatherInfoTool()
```

</hfoption>
<hfoption id="llama-index">

```python
import random
from llama_index.core.tools import FunctionTool

def get_weather_info(location: str) -> str:
    """Fetches dummy weather information for a given location."""
    # Dummy weather data
    weather_conditions = [
        {"condition": "Rainy", "temp_c": 15},
        {"condition": "Clear", "temp_c": 25},
        {"condition": "Windy", "temp_c": 20}
    ]
    # Randomly select a weather condition
    data = random.choice(weather_conditions)
    return f"Weather in {location}: {data['condition']}, {data['temp_c']}°C"

# Initialize the tool
weather_info_tool = FunctionTool.from_defaults(get_weather_info)

print(weather_info_tool('Paris'))
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain.tools import Tool
import random

def get_weather_info(location: str) -> str:
    """Fetches dummy weather information for a given location."""
    # Dummy weather data
    weather_conditions = [
        {"condition": "Rainy", "temp_c": 15},
        {"condition": "Clear", "temp_c": 25},
        {"condition": "Windy", "temp_c": 20}
    ]
    # Randomly select a weather condition
    data = random.choice(weather_conditions)
    return f"Weather in {location}: {data['condition']}, {data['temp_c']}°C"

weather_info_tool = Tool(
    name="get_weather_info",
    func=get_weather_info,
    description="Fetches dummy weather information for a given location."
)

print(weather_info_tool.invoke('Paris'))
```

</hfoption>
</hfoptions>

## Creating a Hub Stats Tool for Influential AI Builders

Alfred can impress influential AI builders by discussing their most popular models. We'll create a tool to fetch model statistics from the Hugging Face Hub based on a username.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import Tool
from huggingface_hub import list_models

class HubStatsTool(Tool):
    name = "hub_stats"
    description = "Fetches the most downloaded model from a specific author on the Hugging Face Hub."
    inputs = {
        "author": {
            "type": "string",
            "description": "The username of the model author/organization to find models from."
        }
    }
    output_type = "string"

    def forward(self, author: str):
        try:
            # List models from the specified author, sorted by downloads
            models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))
            
            if models:
                model = models[0]
                return f"The most downloaded model by {author} is {model.id} with {model.downloads:,} downloads."
            else:
                return f"No models found for author {author}."
        except Exception as e:
            return f"Error fetching models for {author}: {str(e)}"

# Initialize the tool
hub_stats_tool = HubStatsTool()

# Example usage
print(hub_stats_tool("facebook")) # Example: Get the most downloaded model by Facebook
```

Expected output:

```Python
The most downloaded model by facebook is facebook/esmfold_v1 with 12,544,550 downloads.
```

</hfoption>
<hfoption id="llama-index">

```python
import random
from llama_index.core.tools import FunctionTool
from huggingface_hub import list_models

def get_hub_stats(author: str) -> str:
    """Fetches the most downloaded model from a specific author on the Hugging Face Hub."""
    try:
        # List models from the specified author, sorted by downloads
        models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))

        if models:
            model = models[0]
            return f"The most downloaded model by {author} is {model.id} with {model.downloads:,} downloads."
        else:
            return f"No models found for author {author}."
    except Exception as e:
        return f"Error fetching models for {author}: {str(e)}"

# Initialize the tool
hub_stats_tool = FunctionTool.from_defaults(get_hub_stats)

# Example usage
print(hub_stats_tool("facebook")) # Example: Get the most downloaded model by Facebook
```

Expected output:

```python
The most downloaded model by facebook is facebook/esmfold_v1 with 12,544,550 downloads.
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain.tools import Tool
from huggingface_hub import list_models

def get_hub_stats(author: str) -> str:
    """Fetches the most downloaded model from a specific author on the Hugging Face Hub."""
    try:
        # List models from the specified author, sorted by downloads
        models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))

        if models:
            model = models[0]
            return f"The most downloaded model by {author} is {model.id} with {model.downloads:,} downloads."
        else:
            return f"No models found for author {author}."
    except Exception as e:
        return f"Error fetching models for {author}: {str(e)}"

# Initialize the tool
hub_stats_tool = Tool(
    name="get_hub_stats",
    func=get_hub_stats,
    description="Fetches the most downloaded model from a specific author on the Hugging Face Hub."
)

# Example usage
print(hub_stats_tool("facebook")) # Example: Get the most downloaded model by Facebook
```

Expected output:

```python
The most downloaded model by facebook is facebook/esmfold_v1 with 13,109,861 downloads.
```

</hfoption>
</hfoptions>

With the Hub Stats Tool, Alfred can now impress influential AI builders by discussing their most popular models.

## Integrating Tools with Alfred

Now that we have all the tools, let's integrate them into Alfred's agent:

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import CodeAgent, HfApiModel

# Initialize the Hugging Face model
model = HfApiModel()

# Create Alfred with all the tools
alfred = CodeAgent(
    tools=[search_tool, weather_info_tool, hub_stats_tool], 
    model=model
)

# Example query Alfred might receive during the gala
response = alfred.run("Who is Meta AI and what's their most popular model?")

print("🎩 Alfred's Response:")
print(response)
```

Expected output: 

```python
🎩 Alfred's Response:
Meta or previously facebook is an American multinational technology conglomerate.
The most downloaded model by facebook is facebook/esmfold_v1 with 12.195.721 downloads.
```

</hfoption>
<hfoption id="llama-index">

```python
from llama_index.core.agent.workflow import AgentWorkflow
from llama_index.llms.huggingface_api import HuggingFaceInferenceAPI

# Initialize the Hugging Face model
llm = HuggingFaceInferenceAPI(model_name="Qwen/Qwen2.5-Coder-32B-Instruct")
# Create Alfred with all the tools
alfred = AgentWorkflow.from_tools_or_functions(
    [search_tool, weather_info_tool, hub_stats_tool],
    llm=llm
)

# Example query Alfred might receive during the gala
response = await alfred.run("What is Facebook and what's their most popular model?")

print("🎩 Alfred's Response:")
print(response)
```

Expected output: 

```python
🎩 Alfred's Response:
Facebook is a social networking service and technology company based in Menlo Park, California. It was founded by Mark Zuckerberg and allows people to create profiles, connect with friends and family, share photos and videos, and join groups based on shared interests. The most popular model by Facebook on the Hugging Face Hub is `facebook/esmfold_v1` with 13,109,861 downloads.
```

</hfoption>
<hfoption id="langgraph">

```python
from typing import TypedDict, Annotated, Optional
from langchain.llms import HuggingFaceHub
from langgraph.graph.message import add_messages
from langgraph.graph import StateGraph
from langchain_core.messages import AnyMessage, HumanMessage, AIMessage

class AgentState(TypedDict):
    response: Optional[str]
    messages: Annotated[list[AnyMessage], add_messages]

llm = HuggingFaceHub(
    repo_id="Qwen/Qwen2.5-Coder-32B-Instruct", 
    huggingfacehub_api_token=HUGGINGFACEHUB_API_TOKEN
)

def tools_node(data):
    messages = data["messages"]
    query = messages[-1].content.strip()
    
    if "weather" in query:
        location_match = re.search(r"weather.*in\s+([a-zA-Z\s]+)", query)
        response = weather_info_tool.invoke(location_match.group(1).strip()) if location_match else "Location not found."
    elif "hugging face" in query.lower():
        if "facebook" in query.lower(): response = hub_stats_tool.invoke("facebook")
        elif "google" in query.lower(): response = hub_stats_tool.invoke("google")
        else: response = "Org not found."
    else:
        response = search_tool.invoke(query)

    return {"messages": messages + [AIMessage(content=response)]}


def generate_response(data):
    messages = data["messages"]

    history_text = "\n".join([msg.content for msg in messages])
    prompt = f"{history_text}\nUse only the info retrieved as source.\n"
    
    response_text = llm.invoke(prompt).strip()

    if response_text.startswith(prompt):
        model_response = response_text[len(prompt):].strip()

    messages.append(AIMessage(content=model_response))

    return {"messages": messages, "response": model_response}


builder = StateGraph(AgentState)

builder.add_node("tools_node", tools_node)
builder.add_node("generate_response", generate_response)

builder.set_entry_point("tools_node")
builder.add_edge("tools_node", "generate_response")

graph = builder.compile()

# Example query Alfred might receive during the gala
response = graph.invoke({"messages": "What is Facebook and what's their most popular model on the Hugging Face Hub?"})
print("🎩 Alfred's Response:")
print(response["response"])
```

Expected output:

```python
🎩 Alfred's Response:
According to the company, Meta AI is set to become the world's most widely used AI assistant by the end of the year. Over 400 million people interact with Meta AI monthly, with 185 million using ... Designed to make AI accessible to everyone, the AI model is built on Meta's open-source Llama 3.2 and works across the company's ecosystem allowing users to create, interact, and benefit from AI ... We tried seven of the most popular AI chatbots (ChatGPT, Claude, Grok, Perplexity and Arc Search, Meta AI, Microsoft Copilot) to find out. ... It uses a mix of models to produce its responses ... Yet, the difference is that Meta AI, the chatbot, integrated across Meta's social media platforms, has surpassed 500 million users since its wide release in April 2024. The rise of Meta AI. Meta AI's ascent to 500 million users in just seven months is a testament to its accessibility and utility. Impact of Meta AI on the Metaverse and VR/AR; History of Meta AI. Meta AI started as Facebook AI, focusing on AI research and innovation. In 2021, when Facebook rebranded to Meta, the scope of AI expanded further. Meta AI has made significant advancements in NLP (Natural Language Processing), computer vision, and deep learning. Use Cases of Meta AI
```
</hfoption>
</hfoptions>

## Conclusion

By integrating these tools, Alfred is now equipped to handle a variety of tasks, from web searches to weather updates and model statistics. This ensures he remains the most informed and engaging host at the gala.

<Exercise>
Try implementing a tool that can be used to get the latest news about a specific topic.

When you're done, implement your custom tools in the `tools.py` file.
</Exercise>